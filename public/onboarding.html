<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MindKappa - Personalize Sua ExperiÃªncia</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; color: white; line-height: 1.6;
      display: grid; place-items: center;
    }
    .container { width: 100%; max-width: 520px; padding: 40px 20px; }
    .logo { font-size: 3.2rem; margin-bottom: 12px; text-align: center; }
    h1 { font-size: 2rem; margin-bottom: 8px; text-align: center; }
    .subtitle { font-size: 1.05rem; opacity: .95; margin-bottom: 20px; text-align: center; }
    .card {
      background: rgba(255,255,255,.12);
      border-radius: 16px; padding: 24px; box-shadow: 0 15px 40px rgba(0,0,0,.22);
      backdrop-filter: blur(3px);
    }
    .form-group { margin-bottom: 16px; }
    label { display: block; margin-bottom: 6px; font-weight: 600; }
    input, select {
      width: 100%; padding: 14px; border: none; border-radius: 10px;
      font-size: 1rem; background: rgba(255,255,255,.93); color: #111827;
    }
    .btn {
      background: #ffffff; color: #5b67e7; border: none; padding: 16px;
      font-size: 1.1rem; font-weight: 800; border-radius: 50px; cursor: pointer;
      transition: transform .2s ease, box-shadow .2s ease; width: 100%; margin-top: 10px;
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 18px 40px rgba(0,0,0,.32); }
    .skip-option { text-align: center; margin-top: 14px; }
    .skip-link { color: rgba(255,255,255,.92); text-decoration: underline; font-size: .95rem; }
    .privacy-note { font-size: .8rem; opacity: .85; margin-top: 12px; text-align: center; }

    /* Painel de retomada */
    .resume {
      background: rgba(255,255,255,.15);
      border-radius: 14px; padding: 16px; margin-bottom: 16px;
      border: 1px dashed rgba(255,255,255,.35);
    }
    .resume h3 { margin-bottom: 8px; font-size: 1.05rem; }
    .row { display: flex; gap: 10px; }
    .btn-secondary {
      background: rgba(255,255,255,.14); color: white; border: 1px solid rgba(255,255,255,.35);
      padding: 12px 14px; border-radius: 12px; cursor: pointer; flex: 1;
    }
    .btn-primary-ghost {
      background: #fff; color: #5b67e7; border: none; padding: 12px 14px; border-radius: 12px; cursor: pointer; flex: 1;
      font-weight: 800;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">ðŸŽ¯</div>
    <h1>Personalize sua jornada</h1>
    <div class="subtitle">DÃª um nome ao seu relatÃ³rio e, se quiser, adicione mais contexto. Leva 30 segundos.</div>

    <!-- Painel de retomada (aparece se jÃ¡ houver dados) -->
    <div id="resumePanel" class="resume" style="display:none;">
      <h3>VocÃª jÃ¡ iniciou sua sessÃ£o no MindKappa.</h3>
      <p id="resumeInfo" style="opacity: .95;"></p>
      <div class="row" style="margin-top: 10px;">
        <button class="btn-secondary" id="editDataBtn">Editar dados</button>
        <button class="btn-primary-ghost" id="continueBtn">Continuar testes</button>
      </div>
    </div>

    <div class="card" id="formCard">
      <form id="onboardingForm" novalidate>
        <div class="form-group">
          <label for="name">Como vocÃª quer ser chamado? <span style="opacity:.9;">(obrigatÃ³rio)</span></label>
          <input type="text" id="name" placeholder="Seu nome ou apelido" required />
        </div>

        <div class="form-group">
          <label for="email">Email (opcional â€” para resgatar seu relatÃ³rio mais tarde)</label>
          <input type="email" id="email" placeholder="seu@email.com" />
        </div>

        <div class="form-group">
          <label for="age">Idade (opcional)</label>
          <select id="age">
            <option value="">Prefiro nÃ£o informar</option>
            <option value="18-24">18-24 anos</option>
            <option value="25-34">25-34 anos</option>
            <option value="35-44">35-44 anos</option>
            <option value="45-54">45-54 anos</option>
            <option value="55+">55+ anos</option>
          </select>
        </div>

        <div class="form-group">
          <label for="emotion">Como vocÃª estÃ¡ hoje? (opcional)</label>
          <select id="emotion">
            <option value="">Escolher depois</option>
            <option value="curioso">ðŸ¤” Curioso/Explorador</option>
            <option value="focado">ðŸŽ¯ Focado/Determinado</option>
            <option value="relaxado">ðŸ˜Œ Relaxado/Calmo</option>
            <option value="ansioso">âš¡ Ansioso/Energizado</option>
            <option value="reflexivo">ðŸ§  Reflexivo/Pensativo</option>
          </select>
        </div>

        <button type="submit" class="btn">ðŸš€ ComeÃ§ar meus testes</button>
      </form>

      <div class="skip-option">
        <a href="teste1.html" class="skip-link">Pular agora e ir direto aos testes</a>
      </div>

      <div class="privacy-note">
        Usamos seus dados apenas para personalizar sua experiÃªncia e gerar seu relatÃ³rio.<br/>
        NÃ£o coletamos dados pessoais sensÃ­veis. VocÃª pode editar/remover depois.
      </div>
    </div>
  </div>

  <script>
    const LS_USER_KEY = 'mindkappa_user';
    const LS_SESSION_KEY = 'mindkappa_session';
    const API_URL = (window.env && window.env.API_URL) || (typeof importMeta !== 'undefined' && importMeta.env && importMeta.env.VITE_API_URL) || 'http://localhost:3000';

    function ensureSessionId() {
      let sessionId = localStorage.getItem(LS_SESSION_KEY);
      if (!sessionId) {
        sessionId = 'mk-' + Date.now() + '-' + Math.random().toString(36).slice(2, 10);
        localStorage.setItem(LS_SESSION_KEY, sessionId);
      }
      return sessionId;
    }

    function resumePanelFill(user) {
      const info = document.getElementById('resumeInfo');
      const name = user?.name || 'Explorador(a)';
      const email = user?.email ? ` â€¢ ${user.email}` : '';
      info.textContent = `Nome: ${name}${email}`;
    }

    // Carregar se jÃ¡ houver usuÃ¡rio
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem(LS_USER_KEY);
      if (saved) {
        const user = JSON.parse(saved);
        // Mostra painel de retomada (sem redirecionar)
        document.getElementById('resumePanel').style.display = 'block';
        resumePanelFill(user);
        // Preenche formulÃ¡rio com dados existentes (para editar)
        document.getElementById('name').value = user.name || '';
        document.getElementById('email').value = user.email || '';
        document.getElementById('age').value = user.age || '';
        document.getElementById('emotion').value = user.emotion || '';
      }
    });

    // BotÃµes do painel de retomada
    document.getElementById('continueBtn')?.addEventListener('click', () => {
      ensureSessionId();
      window.location.href = 'teste1.html';
    });
    document.getElementById('editDataBtn')?.addEventListener('click', () => {
      document.getElementById('formCard').scrollIntoView({ behavior: 'smooth' });
    });

    // SubmissÃ£o do formulÃ¡rio
    document.getElementById('onboardingForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      if (!name) {
        alert('Por favor, informe como quer ser chamado(a).');
        return;
      }

      const userData = {
        name,
        email: document.getElementById('email').value.trim() || '',
        age: document.getElementById('age').value || '',
        emotion: document.getElementById('emotion').value || '',
        joinedAt: new Date().toISOString()
      };

      // Salva local
      localStorage.setItem(LS_USER_KEY, JSON.stringify(userData));
      const sessionId = ensureSessionId();

      // (Opcional/MVP) salva no backend â€” nÃ£o bloqueia a navegaÃ§Ã£o
      try {
        fetch(`${API_URL}/api/save-research-data`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userData: { ...userData, sessionId } })
        }).catch(() => {});
      } catch (_) {}

      // Segue para o Teste 1
      window.location.href = 'teste1.html';
    });
  </script>
</body>
</html>
