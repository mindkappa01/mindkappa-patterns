<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCD Technologies - Medidor de Coer√™ncia Decisional</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent1: #e74c3c;
            --accent2: #2980b9;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            margin-top: 0;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .decision-interface {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .decision-btn {
            padding: 1.5rem 3rem;
            font-size: 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .blue-btn {
            background-color: var(--secondary);
            color: white;
        }
        
        .blue-btn:hover {
            background-color: var(--accent2);
            transform: translateY(-3px);
        }
        
        .red-btn {
            background-color: var(--accent1);
            color: white;
        }
        
        .red-btn:hover {
            background-color: #c0392b;
            transform: translateY(-3px);
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 2rem;
        }
        
        .stat-box {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .coherence-indicator {
            height: 20px;
            background: #eee;
            border-radius: 10px;
            margin: 1rem 0;
            overflow: hidden;
            position: relative;
        }
        
        .coherence-level {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .interpretation {
            margin-top: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .history-chart {
            height: 200px;
            margin-top: 1rem;
        }
        
        .session-list {
            margin-top: 2rem;
        }
        
        .session-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .kappa-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem;
            background: var(--dark);
            color: white;
            border-radius: 8px;
        }
        
        /* Modal de Login */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-form {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .login-form h2 {
            margin-top: 0;
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .login-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            font-weight: bold;
        }
        
        .login-btn:hover {
            background-color: var(--accent2);
        }
        
        /* Contexto Section */
        .context-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .context-display {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 0.5rem;
        }
        
        /* Overlay de conclus√£o melhorado */
        .completion-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            color: white;
            padding: 20px;
            text-align: center;
            overflow-y: auto;
        }
        
        .completion-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            backdrop-filter: blur(10px);
        }
        
        .completion-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .completion-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            min-width: 160px;
        }
        
        .review-btn {
            background-color: #7f8c8d;
        }
        
        .completion-btn:hover {
            opacity: 0.9;
        }
        
        .results-summary {
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            text-align: left;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        /* Hist√≥rico de decis√µes */
        .decision-history {
            margin-top: 1.5rem;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .new-session-container {
            text-align: center;
            margin-top: 2rem;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .decision-btn {
                padding: 1.2rem 2rem;
            }
            
            .completion-buttons {
                flex-direction: column;
            }
            
            .completion-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- üîπ NAVBAR MINDKAPPA -->
<nav class="mk-navbar">
  <div class="mk-nav-inner">
    <!-- LOGO -->
    <div class="mk-logo" onclick="window.location.href='index.html'">
      üß† <span>MindKappa</span>
    </div>

    <!-- LINKS -->
    <div class="mk-links">
      <a href="index.html" class="mk-link">In√≠cio</a>
      <a href="coletor.html" class="mk-link">Medidor de (Œ∫)</a>
      <a href="lab.html" class="mk-link">MindKappa Lab</a>
      <a href="sobre.html" class="mk-link">Sobre</a>
    </div>

    <!-- STATUS / SALDO -->
    <div class="mk-status" id="mkStatus">
      üí† <span id="kcoinBalance">0</span> K-Coins
    </div>
  </div>
</nav>

<style>
  /* ====== NAVBAR MINDKAPPA ====== */
  .mk-navbar {
    width: 100%;
    background: linear-gradient(90deg, #1e40af, #3b82f6);
    color: #fff;
    padding: 12px 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  .mk-nav-inner {
    max-width: 1100px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
  }
  .mk-logo {
    font-weight: 700;
    font-size: 1.3rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: opacity .2s;
  }
  .mk-logo:hover { opacity: 0.9; }

  .mk-links {
    display: flex;
    gap: 25px;
  }
  .mk-link {
    color: #e0e7ff;
    text-decoration: none;
    font-weight: 500;
    transition: color .2s;
  }
  .mk-link:hover {
    color: #fff;
  }
  .mk-status {
    background: rgba(255,255,255,0.15);
    border-radius: 25px;
    padding: 6px 14px;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  @media (max-width: 720px) {
    .mk-links { display: none; }
    .mk-status { font-size: 0.85rem; }
  }
</style>

<script>
  // Atualiza saldo de K-Coins (futuro)
  document.addEventListener('DOMContentLoaded', () => {
    const storedBalance = localStorage.getItem('kcoins_balance') || 0;
    document.getElementById('kcoinBalance').textContent = storedBalance;
  });
</script>

    <!-- Modal de Login -->
    <div class="login-modal" id="loginModal">
        <div class="login-form">
            <h2>Acesso ao Sistema MCD</h2>
            <div class="form-group">
                <label for="patientName">Nome do Paciente</label>
                <input type="text" id="patientName" placeholder="Digite seu nome completo">
            </div>
            <div class="form-group">
                <label for="accessCode">C√≥digo de Acesso</label>
                <input type="password" id="accessCode" placeholder="Digite seu c√≥digo de acesso">
            </div>
            <div class="form-group">
                <label for="sessionContext">Contexto da Sess√£o</label>
                <select id="sessionContext">
                    <option value="">Selecione o contexto...</option>
                    <option value="basal">Estado Basal (refer√™ncia)</option>
                    <option value="pre-tarefa">Pr√©-tarefa cognitiva</option>
                    <option value="pos-tarefa">P√≥s-tarefa cognitiva</option>
                    <option value="estimulacao">P√≥s-estimula√ß√£o</option>
                    <option value="intervencao">P√≥s-interven√ß√£o</option>
                    <option value="outro">Outro contexto</option>
                </select>
            </div>
            <button class="login-btn" id="loginBtn">Iniciar Sess√£o</button>
        </div>
    </div>

    <!-- Overlay de Conclus√£o -->
    <div class="completion-overlay" id="completionOverlay" style="display: none;">
        <div class="completion-content">
            <h2>Sess√£o Conclu√≠da!</h2>
            <p>Os resultados foram registrados com sucesso.</p>
            
            <div class="results-summary" id="resultsSummary">
                <!-- Resultados ser√£o preenchidos via JavaScript -->
            </div>
            
            <div class="completion-buttons">
                <button class="completion-btn review-btn" id="reviewDataBtn">Revisar Dados</button>
                <button class="completion-btn" id="newSessionTopBtn">Iniciar Nova Sess√£o</button>
            </div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <header>
            <h1>MCD Technologies</h1>
            <p>Medidor de Coer√™ncia Decisional - An√°lise de Padr√µes Decis√≥rios Baseada em Œ∫ (kappa)</p>
            <p id="patientInfo">Paciente: <span id="patientNameDisplay">N√£o identificado</span> | Sess√£o Ativa</p>
        </header>
        
        <!-- Se√ß√£o de Contexto -->
        <div class="context-section">
            <h3>Contexto da Sess√£o</h3>
            <div class="context-display" id="contextDisplay">
                Contexto n√£o definido
            </div>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h2>Interface de Decis√£o</h2>
                <div class="decision-interface">
                    <p>Escolha conscientemente ou de acordo com seu impulso prim√°rio:</p>
                    <div class="buttons-container" id="buttonsContainer">
                        <!-- Os bot√µes ser√£o posicionados aleatoriamente via JavaScript -->
                    </div>
                    <p>Decis√µes registradas: <span id="decisionCount">0</span>/30</p>
                </div>
            </div>
            
            <div class="card">
                <h2>Coer√™ncia Atual</h2>
                <div class="coherence-display">
                    <h3>Œ∫ = <span id="kappaValue">0.00</span></h3>
                    <div class="coherence-indicator">
                        <div class="coherence-level" id="coherenceBar" style="width: 0%; background-color: #95a5a6;"></div>
                    </div>
                    <div id="coherenceLabel" style="text-align: center; font-weight: bold; color: #7f8c8d;">N√£o calculado</div>
                </div>
                
                <div class="stats-container">
                    <div class="stat-box">
                        <div>Vetor R</div>
                        <div class="stat-value" id="rValue">0.00</div>
                    </div>
                    <div class="stat-box">
                        <div>√Çngulo M√©dio</div>
                        <div class="stat-value" id="meanAngle">0¬∞</div>
                    </div>
                    <div class="stat-box">
                        <div>Concentra√ß√£o</div>
                        <div class="stat-value" id="concentration">0.00</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="interpretation">
            <h2>Interpreta√ß√£o da Coer√™ncia Decisional</h2>
            <p id="interpretationText">Complete pelo menos 30 decis√µes para obter uma an√°lise de coer√™ncia.</p>
            
            <h3>Hist√≥rico de Decis√µes</h3>
            <div class="decision-history" id="decisionHistory">
                <div class="history-item" style="color: #7f8c8d; font-style: italic;">
                    Nenhuma decis√£o registrada ainda
                </div>
            </div>
        </div>
        
        <div class="session-list">
            <h2>√öltimas Sess√µes</h2>
            <div id="sessionsList">
                <div class="session-item">
                    <div>
                        <strong>Sess√£o Neutra de Refer√™ncia</strong>
                        <div>2025-09-03 14:30</div>
                    </div>
                    <div class="kappa-badge" style="background-color: #7f8c8d;">Œ∫ = 0.05</div>
                </div>
                <div class="session-item">
                    <div>
                        <strong>Teste com Vi√©s Simb√≥lico</strong>
                        <div>2025-09-02 11:15</div>
                    </div>
                    <div class="kappa-badge" style="background-color: #e74c3c;">Œ∫ = 12.37</div>
                </div>
                <div class="session-item">
                    <div>
                        <strong>Sess√£o P√≥s-alongamento</strong>
                        <div>2025-09-01 09:45</div>
                    </div>
                    <div class="kappa-badge" style="background-color: #3498db;">Œ∫ = 0.38</div>
                </div>
            </div>
        </div>
        
        <div class="new-session-container">
            <h3>Iniciar Nova Sess√£o</h3>
            <p>Quando estiver pronto para uma nova sess√£o, clique no bot√£o abaixo:</p>
            <button class="completion-btn" id="newSessionBottomBtn" style="display: none;">Iniciar Nova Sess√£o</button>
        </div>
        
        <footer>
            <p>MCD Technologies ¬© 2025 | Vers√£o 2025-09-05</p>
            <p>Sistema validado cientificamente | An√°lise de coer√™ncia baseada na distribui√ß√£o de von Mises</p>
        </footer>
    </div>

    <script>
        // Vari√°veis globais
        let decisions = [];
        let currentSession = {
            id: Date.now(),
            patientName: "",
            context: "",
            startTime: new Date(),
            decisions: [],
            kappa: 0,
            rValue: 0,
            meanAngle: 0
        };
        
        let previousSessions = [
            {
                name: "Sess√£o Neutra de Refer√™ncia",
                date: "2025-09-03 14:30",
                kappa: 0.05,
                context: "Estado Basal"
            },
            {
                name: "Teste com Vi√©s Simb√≥lico",
                date: "2025-09-02 11:15",
                kappa: 12.37,
                context: "Pr√©-tarefa cognitiva"
            },
            {
                name: "Sess√£o P√≥s-alongamento",
                date: "2025-09-01 09:45",
                kappa: 0.38,
                context: "P√≥s-interven√ß√£o"
            }
        ];
        
        // Elementos DOM
        const loginModal = document.getElementById('loginModal');
        const mainContainer = document.getElementById('mainContainer');
        const completionOverlay = document.getElementById('completionOverlay');
        const patientNameInput = document.getElementById('patientName');
        const accessCodeInput = document.getElementById('accessCode');
        const sessionContextInput = document.getElementById('sessionContext');
        const loginBtn = document.getElementById('loginBtn');
        const patientNameDisplay = document.getElementById('patientNameDisplay');
        const contextDisplay = document.getElementById('contextDisplay');
        const patientInfo = document.getElementById('patientInfo');
        const buttonsContainer = document.getElementById('buttonsContainer');
        const blueBtn = document.createElement('button');
        const redBtn = document.createElement('button');
        const decisionCount = document.getElementById('decisionCount');
        const kappaValue = document.getElementById('kappaValue');
        const coherenceBar = document.getElementById('coherenceBar');
        const coherenceLabel = document.getElementById('coherenceLabel');
        const rValue = document.getElementById('rValue');
        const meanAngle = document.getElementById('meanAngle');
        const concentration = document.getElementById('concentration');
        const interpretationText = document.getElementById('interpretationText');
        const decisionHistory = document.getElementById('decisionHistory');
        const sessionsList = document.getElementById('sessionsList');
        const reviewDataBtn = document.getElementById('reviewDataBtn');
        const newSessionTopBtn = document.getElementById('newSessionTopBtn');
        const newSessionBottomBtn = document.getElementById('newSessionBottomBtn');
        const resultsSummary = document.getElementById('resultsSummary');
        
        // Configurar bot√µes
        blueBtn.className = 'decision-btn blue-btn';
        blueBtn.textContent = 'AZUL';
        blueBtn.id = 'blueBtn';
        
        redBtn.className = 'decision-btn red-btn';
        redBtn.textContent = 'VERMELHO';
        redBtn.id = 'redBtn';
        
        // Mapeamento de contextos para exibi√ß√£o
        const contextMap = {
            'basal': 'Estado Basal (refer√™ncia)',
            'pre-tarefa': 'Pr√©-tarefa cognitiva',
            'pos-tarefa': 'P√≥s-tarefa cognitiva',
            'estimulacao': 'P√≥s-estimula√ß√£o',
            'intervencao': 'P√≥s-interven√ß√£o',
            'outro': 'Outro contexto'
        };
        
        // Fun√ß√£o para randomizar a posi√ß√£o dos bot√µes
        function randomizeButtonPosition() {
            buttonsContainer.innerHTML = '';
            if (Math.random() > 0.5) {
                buttonsContainer.appendChild(blueBtn);
                buttonsContainer.appendChild(redBtn);
            } else {
                buttonsContainer.appendChild(redBtn);
                buttonsContainer.appendChild(blueBtn);
            }
        }
        
        // Event listeners
        blueBtn.addEventListener('click', () => recordDecision('blue'));
        redBtn.addEventListener('click', () => recordDecision('red'));
        loginBtn.addEventListener('click', startSession);
        reviewDataBtn.addEventListener('click', hideCompletionOverlay);
        newSessionTopBtn.addEventListener('click', startNewSession);
        newSessionBottomBtn.addEventListener('click', startNewSession);
        
        // Fun√ß√£o para iniciar a sess√£o
        function startSession() {
            const name = patientNameInput.value.trim();
            const accessCode = accessCodeInput.value.trim();
            const context = sessionContextInput.value;
            
            if (name === '') {
                alert('Por favor, digite o nome do paciente.');
                return;
            }
            
            if (accessCode === '') {
                alert('Por favor, digite o c√≥digo de acesso.');
                return;
            }
            
            if (context === '') {
                alert('Por favor, selecione o contexto da sess√£o.');
                return;
            }
            
            currentSession.patientName = name;
            currentSession.context = context;
            patientNameDisplay.textContent = name;
            contextDisplay.textContent = contextMap[context] || context;
            loginModal.style.display = 'none';
            mainContainer.style.display = 'block';
            
            // Inicializar a posi√ß√£o dos bot√µes
            randomizeButtonPosition();
        }
        
        // Fun√ß√£o para ocultar o overlay de conclus√£o
        function hideCompletionOverlay() {
            completionOverlay.style.display = 'none';
            newSessionBottomBtn.style.display = 'block';
        }
        
        // Fun√ß√£o para preencher o resumo de resultados
        function fillResultsSummary() {
            const blueCount = decisions.filter(d => d.choice === 'blue').length;
            const redCount = decisions.filter(d => d.choice === 'red').length;
            
            resultsSummary.innerHTML = `
                <div class="result-item">
                    <span>Paciente:</span>
                    <span><strong>${currentSession.patientName}</strong></span>
                </div>
                <div class="result-item">
                    <span>Contexto:</span>
                    <span><strong>${contextMap[currentSession.context] || currentSession.context}</strong></span>
                </div>
                <div class="result-item">
                    <span>Coer√™ncia (Œ∫):</span>
                    <span><strong>${currentSession.kappa.toFixed(2)}</strong> - ${coherenceLabel.textContent}</span>
                </div>
                <div class="result-item">
                    <span>Decis√µes Azuis:</span>
                    <span><strong>${blueCount}</strong></span>
                </div>
                <div class="result-item">
                    <span>Decis√µes Vermelhas:</span>
                    <span><strong>${redCount}</strong></span>
                </div>
                <div class="result-item">
                    <span>Vetor R:</span>
                    <span><strong>${rValue.textContent}</strong></span>
                </div>
            `;
        }
        
        // Fun√ß√£o para iniciar uma nova sess√£o
        function startNewSession() {
            // Salvar sess√£o atual no hist√≥rico
            if (decisions.length >= 30) {
                previousSessions.unshift({
                    name: `Sess√£o de ${currentSession.patientName}`,
                    date: new Date().toLocaleString('pt-BR'),
                    kappa: currentSession.kappa,
                    context: contextMap[currentSession.context] || currentSession.context
                });
                
                // Atualizar a lista de sess√µes
                updateSessionsList();
            }
            
            // Reiniciar vari√°veis
            decisions = [];
            currentSession = {
                id: Date.now(),
                patientName: currentSession.patientName,
                context: currentSession.context,
                startTime: new Date(),
                decisions: [],
                kappa: 0,
                rValue: 0,
                meanAngle: 0
            };
            
            // Reiniciar UI
            decisionCount.textContent = '0';
            decisionHistory.innerHTML = '<div class="history-item" style="color: #7f8c8d; font-style: italic;">Nenhuma decis√£o registrada ainda</div>';
            completionOverlay.style.display = 'none';
            newSessionBottomBtn.style.display = 'none';
            resetUI();
            
            // Randomizar bot√µes
            randomizeButtonPosition();
        }
        
        // Fun√ß√£o para atualizar a lista de sess√µes
        function updateSessionsList() {
            sessionsList.innerHTML = '';
            
            previousSessions.forEach(session => {
                const sessionItem = document.createElement('div');
                sessionItem.className = 'session-item';
                
                let badgeColor = '#7f8c8d'; // Cinza (padr√£o)
                if (session.kappa > 1.0) badgeColor = '#e74c3c'; // Vermelho (alta coer√™ncia)
                else if (session.kappa > 0.5) badgeColor = '#f39c12'; // Laranja
                else if (session.kappa > 0.3) badgeColor = '#2ecc71'; // Verde
                else if (session.kappa > 0.1) badgeColor = '#3498db'; // Azul
                
                sessionItem.innerHTML = `
                    <div>
                        <strong>${session.name}</strong>
                        <div>${session.date} | ${session.context}</div>
                    </div>
                    <div class="kappa-badge" style="background-color: ${badgeColor};">Œ∫ = ${session.kappa.toFixed(2)}</div>
                `;
                
                sessionsList.appendChild(sessionItem);
            });
        }
        
        // Fun√ß√£o para registrar uma decis√£o
        function recordDecision(choice) {
            // Registrar a decis√£o com timestamp
            const decision = {
                choice: choice,
                angle: choice === 'blue' ? 0 : Math.PI, // 0¬∞ ou 180¬∞ em radianos
                timestamp: Date.now(),
                timeFormatted: new Date().toLocaleTimeString('pt-BR')
            };
            
            decisions.push(decision);
            currentSession.decisions.push(decision);
            
            // Atualizar contador
            decisionCount.textContent = decisions.length;
            
            // Atualizar hist√≥rico de decis√µes
            updateDecisionHistory();
            
            // Randomizar a posi√ß√£o dos bot√µes para a pr√≥xima decis√£o
            randomizeButtonPosition();
            
            // Se tivermos decis√µes suficientes, calcular coer√™ncia
            if (decisions.length >= 30) {
                calculateCoherence();
                
                // Preencher e mostrar overlay de conclus√£o
                fillResultsSummary();
                setTimeout(() => {
                    completionOverlay.style.display = 'flex';
                }, 500);
            }
        }
        
        // Fun√ß√£o para atualizar o hist√≥rico de decis√µes
        function updateDecisionHistory() {
            // Limpar o placeholder se existir
            if (decisionHistory.querySelector('[style*="italic"]')) {
                decisionHistory.innerHTML = '';
            }
            
            // Mostrar apenas as √∫ltimas 10 decis√µes para n√£o sobrecarregar a UI
            const recentDecisions = decisions.slice(-10);
            
            recentDecisions.forEach(decision => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                historyItem.innerHTML = `
                    <span>${decision.timeFormatted}</span>
                    <span style="color: ${decision.choice === 'blue' ? '#3498db' : '#e74c3c'}; font-weight: bold;">
                        ${decision.choice === 'blue' ? 'AZUL' : 'VERMELHO'}
                    </span>
                `;
                
                decisionHistory.appendChild(historyItem);
            });
            
            // Manter o scroll no final
            decisionHistory.scrollTop = decisionHistory.scrollHeight;
        }
        
        // Fun√ß√£o para calcular coer√™ncia (simplificado para demonstra√ß√£o)
        function calculateCoherence() {
            // Em uma implementa√ß√£o real, isso seria feito no backend
            // com o algoritmo proper de estat√≠stica circular
            
            // Simula√ß√£o de c√°lculo de kappa baseado no padr√£o de decis√µes
            const blueCount = decisions.filter(d => d.choice === 'blue').length;
            const redCount = decisions.filter(d => d.choice === 'red').length;
            
            // Simular diferentes valores de kappa baseado no padr√£o
            let simulatedKappa;
            if (blueCount === redCount) {
                simulatedKappa = 0.05; // Aleat√≥rio
            } else if (Math.abs(blueCount - redCount) < 5) {
                simulatedKappa = 0.2; // Quase aleat√≥rio
            } else if (Math.abs(blueCount - redCount) < 10) {
                simulatedKappa = 0.4; // Moderadamente coerente
            } else if (Math.abs(blueCount - redCount) < 15) {
                simulatedKappa = 0.7; // Coerente
            } else {
                simulatedKappa = 1.2; // Altamente coerente
            }
            
            // Adicionar algum ru√≠do para tornar mais realista
            simulatedKappa += (Math.random() * 0.1 - 0.05);
            simulatedKappa = Math.max(0, simulatedKappa); // N√£o permitir valores negativos
            
            // Salvar no objeto de sess√£o atual
            currentSession.kappa = simulatedKappa;
            
            // Atualizar UI com valores calculados
            updateCoherenceUI(simulatedKappa);
        }
        
        // Fun√ß√£o para atualizar a UI com os valores de coer√™ncia
        function updateCoherenceUI(kappa) {
            kappaValue.textContent = kappa.toFixed(2);
            
            // Atualizar barra de coer√™ncia
            let barWidth = Math.min(100, kappa * 50); // Ajuste de escala para visualiza√ß√£o
            coherenceBar.style.width = `${barWidth}%`;
            
            // Atualizar cor baseada no valor de kappa
            let barColor, coherenceText;
            
            if (kappa < 0.1) {
                barColor = '#95a5a6';
                coherenceText = 'Padr√£o Aleat√≥rio';
            } else if (kappa < 0.3) {
                barColor = '#3498db';
                coherenceText = 'Quase Aleat√≥rio';
            } else if (kappa < 0.5) {
                barColor = '#2ecc71';
                coherenceText = 'Moderadamente Coerente';
            } else if (kappa < 1.0) {
                barColor = '#f39c12';
                coherenceText = 'Coerente';
            } else {
                barColor = '#e74c3c';
                coherenceText = 'Altamente Coerente';
            }
            
            coherenceBar.style.backgroundColor = barColor;
            coherenceLabel.textContent = coherenceText;
            coherenceLabel.style.color = barColor;
            
            // Atualizar outros valores estat√≠sticos (simulados)
            rValue.textContent = (kappa / 2.5).toFixed(2);
            meanAngle.textContent = `${Math.round((Math.random() * 180))}¬∞`;
            concentration.textContent = (kappa * 1.2).toFixed(2);
            
            // Atualizar interpreta√ß√£o
            updateInterpretation(kappa);
        }
        
        // Fun√ß√£o para atualizar o texto de interpreta√ß√£o
        function updateInterpretation(kappa) {
            let interpretation;
            
            if (kappa < 0.1) {
                interpretation = "Seu padr√£o decisional apresenta aleatoriedade significativa. Isso pode indicar: estado neutro, fadiga, ou influ√™ncia de subst√¢ncias. Padr√£o t√≠pico de sess√µes sob efeito de √°lcool ou cansa√ßo extremo.";
            } else if (kappa < 0.3) {
                interpretation = "Baixa coer√™ncia decisional. Poss√≠vel estado de distra√ß√£o ou baixo engajamento com o processo. Similar a sess√µes realizadas em estado de multitarefa ou leve sonol√™ncia.";
            } else if (kappa < 0.5) {
                interpretation = "Coer√™ncia moderada. Indica algum n√≠vel de padr√£o intencional, mas com flutua√ß√µes. Compat√≠vel com estados de desenvolvimento creativo ou trabalho focado sem estresse excessivo.";
            } else if (kappa < 1.0) {
                interpretation = "Alta coer√™ncia decisional. Padr√£o consistente sugere forte vi√©s intencional ou simb√≥lico. Associado a estados de concentra√ß√£o profunda ou motiva√ß√£o espec√≠fica.";
            } else {
                interpretation = "Coer√™ncia excepcionalmente alta. Padr√£o altamente direcional, possivelmente indicando vi√©s consciente muito forte ou estado de flow. T√≠pico de sess√µes com simbolismo deliberado.";
            }
            
            interpretationText.innerHTML = `<strong>Interpreta√ß√£o (Œ∫ = ${kappa.toFixed(2)}):</strong> ${interpretation}`;
        }
        
        // Fun√ß√£o para resetar a UI para o estado inicial
        function resetUI() {
            kappaValue.textContent = "0.00";
            coherenceBar.style.width = "0%";
            coherenceBar.style.backgroundColor = "#95a5a6";
            coherenceLabel.textContent = "N√£o calculado";
            coherenceLabel.style.color = "#7f8c8d";
            rValue.textContent = "0.00";
            meanAngle.textContent = "0¬∞";
            concentration.textContent = "0.00";
            interpretationText.textContent = "Complete pelo menos 30 decis√µes para obter uma an√°lise de coer√™ncia.";
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar a lista de sess√µes
            updateSessionsList();
            console.log("MCD Technologies - Sistema de An√°lise de Coer√™ncia Decisional inicializado");
        });
    </script>
</body>
</html>