<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seu Relat√≥rio MindKappa | Resultados</title>
    <link rel="stylesheet" href="assets/style.css">
    <style>
        .report-container { text-align: center; padding: 20px; }
        .loading-spinner { 
            width: 60px; height: 60px; border: 6px solid #e2e8f0; 
            border-top: 6px solid #63b3ed; border-radius: 50%; 
            animation: spin 1s linear infinite; margin: 30px auto; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .report-content { text-align: left; background: white; padding: 30px; border-radius: 15px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .premium-cta { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; padding: 25px; border-radius: 15px; margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .feature-list { text-align: left; margin: 20px 0; }
        .feature-item { margin: 12px 0; padding-left: 25px; position: relative; font-size: 1rem; }
        .feature-item:before { content: "‚úì"; position: absolute; left: 0; color: #48bb78; font-weight: bold; }
        .insight-item { background: rgba(99, 179, 237, 0.1); padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #63b3ed; }
        .user-header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; }
        
        .btn { 
            background: linear-gradient(45deg, #63b3ed, #4299e1);
            color: white; border: none; padding: 15px 30px; 
            font-size: 1.1rem; font-weight: 600; border-radius: 50px; 
            cursor: pointer; transition: all 0.3s ease; width: 100%; 
            margin-top: 10px; 
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(99, 179, 237, 0.4); }
        
        .fallback-message { 
            background: #fff3cd; border: 1px solid #ffeaa7; 
            padding: 20px; border-radius: 10px; margin: 20px 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="report-container">
                <div class="logo">üìä</div>
                <div class="title">Seu Relat√≥rio MindKappa</div>
                <div class="subtitle">An√°lise personalizada baseada em 120 decis√µes</div>
                
                <div id="reportContent">
                    <!-- Conte√∫do din√¢mico -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const elements = {
            reportContent: document.getElementById('reportContent')
        };

        function initializeReport() {
            const userData = JSON.parse(localStorage.getItem('mindkappa_user'));
            
            if (!userData) {
                window.location.href = 'onboarding.html';
                return;
            }

            showGenerateButton(userData);
        }

        function showGenerateButton(userData) {
            elements.reportContent.innerHTML = `
                <div class="user-header">
                    <div style="font-size: 1.3rem; margin-bottom: 5px;">${userData.name}</div>
                    <div style="opacity: 0.9;">${userData.age} anos ‚Ä¢ ${userData.emotion}</div>
                </div>
                
                <div style="margin: 30px 0;">
                    <div style="color: #4a5568; margin-bottom: 25px; line-height: 1.6;">
                        <strong>3 testes completos ‚Ä¢ 120 decis√µes analisadas</strong><br>
                        <span style="color: #718096; font-size: 0.95rem;">
                            ‚ö° Instinto Puro ‚Ä¢ ‚öñÔ∏è Equil√≠brio Mental ‚Ä¢ ‚è∞ Press√£o Temporal
                        </span>
                    </div>
                    <button class="btn" onclick="generateReport()" style="font-size: 1.2rem; padding: 18px 40px;">
                        üß† Gerar Meu Relat√≥rio com IA
                    </button>
                    <div style="color: #718096; font-size: 0.9rem; margin-top: 15px;">
                        An√°lise profunda dos seus padr√µes √∫nicos
                    </div>
                </div>
            `;
        }

        async function generateReport() {
            // Mostrar loading
            elements.reportContent.innerHTML = `
                <div style="margin: 40px 0;">
                    <div class="loading-spinner"></div>
                    <div style="color: #4a5568; margin-top: 20px;">
                        Analisando seus padr√µes com IA avan√ßada...
                    </div>
                    <div style="color: #718096; font-size: 0.9rem; margin-top: 10px;">
                        Processando 120 decis√µes ‚Ä¢ Gerando insights exclusivos
                    </div>
                </div>
            `;

            try {
                const userData = JSON.parse(localStorage.getItem('mindkappa_user'));
                const gptResponse = await callGPT4API(userData);
                showFinalReport(gptResponse, userData);
            } catch (error) {
                console.error('Erro:', error);
                showErrorState();
            }
        }

        // üéØ FUN√á√ÉO SEGURA - CHAMA BACKEND
        async function callGPT4API(userData) {
            try {
                // URL do seu backend no Railway
                const response = await fetch('https://mindkappa-patterns-production.up.railway.app/api/generate-report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userData })
                });
                
                if (!response.ok) {
                    throw new Error('Servidor indispon√≠vel');
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Erro backend:', error);
                // Fallback seguro
                return generateFallbackReport(userData);
            }
        }

        function generateFallbackReport(userData) {
            // Relat√≥rio b√°sico enquanto backend n√£o est√° pronto
            const teste1 = analyzeTest1(userData.teste1);
            const teste2 = analyzeTest2(userData.teste2);
            const teste3 = analyzeTest3(userData.teste3);
            
            return {
                relatorio: `
üß† Seu Relat√≥rio MindKappa - An√°lise B√°sica

üìä Seus Resultados:

TESTE 1 - INSTINTO PURO:
‚Ä¢ O que voc√™ fez: ${teste1.summary}
‚Ä¢ Padr√£o detectado: ${teste1.pattern}

TESTE 2 - EQUIL√çBRIO MENTAL:  
‚Ä¢ O que voc√™ fez: ${teste2.summary}
‚Ä¢ Habilidade de controle: ${teste2.control}

TESTE 3 - PRESS√ÉO TEMPORAL:
‚Ä¢ O que voc√™ fez: ${teste3.summary}
‚Ä¢ Performance sob press√£o: ${teste3.performance}

üí° Seus Padr√µes √önicos:
Seus resultados mostram padr√µes interessantes de tomada de decis√£o. Quando o sistema estiver completo, voc√™ receber√° uma an√°lise detalhada com compara√ß√µes e insights personalizados.

üéØ Pr√≥ximos Passos:
Continue acompanhando para receber o relat√≥rio completo com IA!
                `,
                insights: [
                    "Seus dados foram salvos para an√°lise futura",
                    "Relat√≥rio completo em breve com IA",
                    "Padr√µes √∫nicos detectados em seus testes"
                ]
            };
        }

        function analyzeTest1(teste1) {
            if (!teste1 || !teste1.decisions) {
                return { summary: 'Dados em an√°lise', pattern: 'Padr√£o emergente' };
            }
            
            const azul = teste1.decisions.filter(d => d.choice === 'azul').length;
            const vermelho = teste1.decisions.filter(d => d.choice === 'vermelho').length;
            const total = azul + vermelho;
            
            let pattern = 'Equilibrado';
            if (azul > vermelho * 1.5) pattern = 'Prefer√™ncia por azul';
            else if (vermelho > azul * 1.5) pattern = 'Prefer√™ncia por vermelho';
            
            return {
                summary: `${azul} azuis, ${vermelho} vermelhos`,
                pattern: pattern
            };
        }

        function analyzeTest2(teste2) {
            if (!teste2 || !teste2.finalCounts) {
                return { summary: 'Dados em an√°lise', control: 'Habilidade em desenvolvimento' };
            }
            
            const diff = Math.abs(teste2.finalCounts.azul - teste2.finalCounts.vermelho);
            let control = 'Excelente controle';
            if (diff > 8) control = 'Prefer√™ncias definidas';
            else if (diff > 4) control = 'Bom equil√≠brio';
            
            return {
                summary: `${teste2.finalCounts.azul} azuis, ${teste2.finalCounts.vermelho} vermelhos`,
                control: control
            };
        }

        function analyzeTest3(teste3) {
            if (!teste3 || !teste3.pressureAnalysis) {
                return { summary: 'Dados em an√°lise', performance: 'Resposta em observa√ß√£o' };
            }
            
            const timeouts = teste3.pressureAnalysis.totalTimeouts || 0;
            let performance = 'Alta resist√™ncia √† press√£o';
            if (timeouts > 5) performance = 'Sens√≠vel √† press√£o temporal';
            else if (timeouts > 2) performance = 'Boa adapta√ß√£o';
            
            return {
                summary: `${timeouts} timeouts em 30 decis√µes`,
                performance: performance
            };
        }

        function showFinalReport(gptResponse, userData) {
            elements.reportContent.innerHTML = `
                <div class="user-header">
                    <div style="font-size: 1.3rem; margin-bottom: 5px;">${userData.name}</div>
                    <div style="opacity: 0.9;">Relat√≥rio Personalizado ‚Ä¢ ${new Date().toLocaleDateString()}</div>
                </div>

                <div class="report-content">
                    <div style="color: #4a5568; line-height: 1.7; white-space: pre-line;">
                        ${gptResponse.relatorio}
                    </div>
                </div>

                <!-- CTA PREMIUM -->
                <div class="premium-cta">
                    <h3 style="margin-bottom: 15px;">üöÄ SEJA UM DOS PRIMEIROS!</h3>
                    <div style="margin-bottom: 20px; line-height: 1.5;">
                        <strong>Antecipe seu acesso ao MindKappa Complete</strong><br>
                        Antes do lan√ßamento oficial, garanta acesso privilegiado:
                    </div>
                    
                    <div class="feature-list">
                        <div class="feature-item">+4 testes exclusivos (7 no total)</div>
                        <div class="feature-item">An√°lise com 300+ decis√µes</div>
                        <div class="feature-item">Pre√ßo especial de fundador</div>
                        <div class="feature-item">Suporte priorit√°rio</div>
                    </div>
                    
                    <button class="btn" onclick="anteciparAcesso()" 
                            style="background: white; color: #2d3748; margin-top: 20px; font-weight: bold;">
                        üéØ QUERO SER DOS PRIMEIROS!
                    </button>
                    
                    <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;">
                        Vagas limitadas para testadores fundadores
                    </div>
                </div>

                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: center;">
                    <button class="btn" onclick="window.location.href='index.html'" 
                            style="background: #e2e8f0; color: #4a5568; flex: 1;">
                        üè† Voltar ao In√≠cio
                    </button>
                    <button class="btn" onclick="newAnalysis()" 
                            style="background: #63b3ed; color: white; flex: 1;">
                        üîÑ Nova An√°lise
                    </button>
                </div>
            `;
        }

        function showErrorState() {
            elements.reportContent.innerHTML = `
                <div class="fallback-message">
                    <div style="font-size: 1.2rem; margin-bottom: 10px;">üòï Sistema em Atualiza√ß√£o</div>
                    <div style="margin-bottom: 15px;">
                        Nossa an√°lise com IA est√° passando por melhorias. 
                        Enquanto isso, aqui est√° uma vis√£o dos seus dados:
                    </div>
                    <button class="btn" onclick="showBasicAnalysis()" 
                            style="background: #667eea; color: white;">
                        üìä Ver An√°lise B√°sica
                    </button>
                </div>
            `;
        }

        function showBasicAnalysis() {
            const userData = JSON.parse(localStorage.getItem('mindkappa_user'));
            const fallback = generateFallbackReport(userData);
            showFinalReport(fallback, userData);
        }

        function anteciparAcesso() {
            alert('üéâ Obrigado pelo interesse!\n\nEm breve entraremos em contato sobre o acesso antecipado ao MindKappa Complete!\n\nEnquanto isso, seus dados est√£o salvos para an√°lise futura.');
        }

        function newAnalysis() {
            if (confirm('Isso ir√° reiniciar todo o processo. Tem certeza?')) {
                localStorage.removeItem('mindkappa_user');
                window.location.href = 'onboarding.html';
            }
        }

        // Inicializar
        window.addEventListener('load', initializeReport);
    </script>
</body>
</html>


